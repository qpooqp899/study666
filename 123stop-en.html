<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>1 2 3 æœ¨é ­äºº - å–®å­—æŒ‘æˆ°</title>
  <style>
    body, html {
      margin: 0; padding: 0;
      font-family: sans-serif;
      height: 100%;
      background: #f0f0f0;
      text-align: center;
    }
    #status { font-size: 20px; margin: 5px; }
    #timer, #stats { font-size: 18px; margin-bottom: 6px; }
    #gameArea {
      width: 100vw; height: 60vh;
      background-color: #a3d5a3;
      position: relative; overflow: hidden;
      transition: background-color 0.5s;
    }
    #grid {
      position: absolute; bottom: 0; width: 100%; height: 100%;
      display: flex; flex-direction: column-reverse;
      z-index: 0;
    }
    .grid-line {
      flex: 1; border-top: 1px dashed #888;
    }
    #player {
      position: absolute; font-size: 8vw;
      width: 10vw; height: 10vw;
      text-align: center; line-height: 10vw;
      bottom: 0; left: 50%;
      transform: translateX(-50%);
      z-index: 2;
      transition: bottom 0.2s;
    }
    #doll {
      position: absolute; top: 10px; left: 50%;
      transform: translateX(-50%);
      font-size: 12vw; z-index: 3;
      transition: transform 0.3s ease;
    }
    #controls {
      display: flex; flex-direction: column;
      align-items: center; gap: 8px; padding: 10px;
    }
    #emojiSelect, #startBtn, #difficultySelect {
      font-size: 18px; padding: 10px;
      width: 70vw; max-width: 300px;
    }
    #questionArea {
      margin-top: 10px;
    }
    .optionBtn {
      font-size: 18px; padding: 8px;
      margin: 5px; width: 40vw; max-width: 200px;
    }
  </style>
</head>
<body>
<a href="index.html" style="position:absolute;left:10px;top:10px;font-size:24px;text-decoration:none;background:#eee;padding:6px 18px;border-radius:8px;color:#222;box-shadow:0 2px 6px #ccc;">â† è¿”å›é¸å–®</a>
 
<div>

  <h1 style="font-size: 22px;margin-top: 80px;">1ã€2ã€3 æœ¨é ­äºº ğŸŸ¢ğŸŸ¡ğŸ”´ï¼ˆå–®å­—æŒ‘æˆ°ï¼‰</h1>

<div id="controls">
  <select id="emojiSelect">
    <option>ğŸ¥</option><option>ğŸ±</option><option>ğŸ¶</option><option>ğŸ¦Š</option><option>ğŸ°</option>
    <option>ğŸ¸</option><option>ğŸ·</option><option>ğŸµ</option><option>ğŸ¯</option><option>ğŸ¼</option>
  </select>

  <select id="difficultySelect">
    <option value="180">ğŸŸ¢ ç°¡å–®ï¼ˆ180ç§’ï¼‰</option>
    <option value="120">ğŸŸ¡ ä¸­ç­‰ï¼ˆ120ç§’ï¼‰</option>
    <option value="60">ğŸ”´ å›°é›£ï¼ˆ60ç§’ï¼‰</option>
  </select>

  <button id="startBtn">é–‹å§‹éŠæˆ²</button>
</div>

<div id="status">é»æ“Šé–‹å§‹ç­”é¡Œå‰é€²</div>
<div id="timer">å‰©é¤˜æ™‚é–“ï¼š-</div>
<div id="stats">âœ… ç­”å°ï¼š0 / ç¸½é¡Œæ•¸ï¼š0ï½œé‡‘å¹£ï¼š0</div>
<div id="gameArea">
  <div id="doll">ğŸ‘§</div>
  <div id="grid"></div>
  <div id="player">ğŸ¥</div>
</div>
<div id="questionArea"></div>

<script>
  const player = document.getElementById('player');
  const doll = document.getElementById('doll');
  const statusText = document.getElementById('status');
  const timerText = document.getElementById('timer');
  const statsText = document.getElementById('stats');
  const startBtn = document.getElementById('startBtn');
  const emojiSelect = document.getElementById('emojiSelect');
  const difficultySelect = document.getElementById('difficultySelect');
  const gameArea = document.getElementById('gameArea');
  const grid = document.getElementById('grid');
  const questionArea = document.getElementById('questionArea');
  const controls = document.getElementById('controls');

  let lightState = 'red';
  let currentStep = 0;
  const totalSteps = 15;
  let gameOver = false;
  let stepHeight;
  let timer;
  let timeLeft;
  let correctCount = 0;
  let totalCount = 0;
  // å¾localStorageè®€é‡‘å¹£
  let coins = parseInt(localStorage.getItem('coins') || '0');

  // é¡Œåº«æ“´å……åˆ°300çµ„ (é€™è£¡ç¤ºç¯„åªæ”¾éƒ¨åˆ†ï¼Œå¯¦éš›è«‹è£œè¶³å®Œæ•´300çµ„)
  const wordList = [
    { zh: "è˜‹æœ", en: "apple" }, { zh: "é¦™è•‰", en: "banana" }, { zh: "è²“", en: "cat" },
    { zh: "ç‹—", en: "dog" }, { zh: "æ¤…å­", en: "chair" }, { zh: "æ¡Œå­", en: "table" },
    { zh: "æ›¸", en: "book" }, { zh: "æ°´", en: "water" }, { zh: "ç«", en: "fire" },
    { zh: "å±±", en: "mountain" }, { zh: "å¤ªé™½", en: "sun" }, { zh: "æœˆäº®", en: "moon" },
    { zh: "é­š", en: "fish" }, { zh: "é³¥", en: "bird" }, { zh: "è»Š", en: "car" },
    { zh: "å·´å£«", en: "bus" }, { zh: "æ‰‹æ©Ÿ", en: "phone" }, { zh: "é›»è…¦", en: "computer" },
    { zh: "æœ‹å‹", en: "friend" }, { zh: "å®¶åº­", en: "family" },
      { zh: "èŠ±", en: "flower" }, { zh: "æ¨¹", en: "tree" }, { zh: "å¤©ç©º", en: "sky" },
  { zh: "æµ·æ´‹", en: "ocean" }, { zh: "é›¨", en: "rain" }, { zh: "é›ª", en: "snow" },
  { zh: "è‰", en: "grass" }, { zh: "æ²™", en: "sand" }, { zh: "è·¯", en: "road" },
  { zh: "æ©‹", en: "bridge" }, { zh: "ç«è»Š", en: "train" }, { zh: "é£›æ©Ÿ", en: "plane" },
  { zh: "èˆ¹", en: "ship" }, { zh: "é˜", en: "clock" }, { zh: "ç­†", en: "pen" },
  { zh: "ç´™", en: "paper" }, { zh: "çª—æˆ¶", en: "window" }, { zh: "é–€", en: "door" },
  { zh: "åŸå¸‚", en: "city" }, { zh: "é„‰æ‘", en: "village" },
    // .... çºŒè£œå‰©ä¸‹280çµ„ ...
  ];

  function updateStats() {
    statsText.innerText = `âœ… ç­”å°ï¼š${correctCount} / ç¸½é¡Œæ•¸ï¼š${totalCount}ï½œé‡‘å¹£ï¼š${coins}`;
  }

  function drawGrid() {
    grid.innerHTML = '';
    for (let i = 0; i < totalSteps; i++) {
      const line = document.createElement('div');
      line.className = 'grid-line';
      grid.appendChild(line);
    }
  }

  function setLight(state) {
    lightState = state;
    switch(state) {
      case 'green':
        gameArea.style.backgroundColor = '#a3d5a3';
        statusText.innerText = 'ğŸŸ¢ ç¶ ç‡ˆï¼å¿«èµ°ï¼';
        doll.innerText = 'ğŸ‘§';
        doll.style.transform = 'translateX(-50%) rotateY(180deg)';
        break;
      case 'yellow':
        gameArea.style.backgroundColor = '#ffe066';
        statusText.innerText = 'ğŸŸ¡ é»ƒç‡ˆå°å¿ƒï¼';
        doll.innerText = 'ğŸ˜';
        doll.style.transform = 'translateX(-50%) rotateY(90deg)';
        break;
      case 'red':
        gameArea.style.backgroundColor = '#ff6b6b';
        statusText.innerText = 'ğŸ”´ ç´…ç‡ˆä¸èƒ½å‹•ï¼';
        doll.innerText = 'ğŸ™…â€â™€ï¸';
        doll.style.transform = 'translateX(-50%) rotateY(0deg)';
        break;
    }
  }

  function scheduleNextLight() {
    if(gameOver) return;
    setLight('green');
    const greenTime = Math.random()*2000 + 1500;
    setTimeout(() => {
      setLight('yellow');
      const yellowTime = Math.random()*2000 + 1000;
      setTimeout(() => {
        setLight('red');
        const redTime = Math.random()*2000 + 1500;
        setTimeout(scheduleNextLight, redTime);
      }, yellowTime);
    }, greenTime);
  }

  function showQuestion() {
    if(gameOver) return;
    questionArea.innerHTML = '';
    const question = wordList[Math.floor(Math.random()*wordList.length)];
    const correct = question.en;
    const options = [correct];
    while(options.length < 4) {
      const randomWord = wordList[Math.floor(Math.random()*wordList.length)].en;
      if(!options.includes(randomWord)) options.push(randomWord);
    }
    options.sort(() => Math.random() - 0.5);
    const qText = document.createElement('div');
    qText.innerText = `â“ã€Œ${question.zh}ã€æ˜¯ï¼Ÿ`;
    questionArea.appendChild(qText);
    options.forEach(opt=>{
      const btn = document.createElement('button');
      btn.innerText = opt;
      btn.className = 'optionBtn';
      btn.onclick = () => {
        totalCount++;
        if(opt === correct) {
           speak(correct);  // æ’­æ”¾è‹±æ–‡å–®å­—
          correctCount++;
          coins += 5; // ã€ç­”å°å³ +5 é‡‘å¹£ã€‘
          showCoinAnimation(5);// é¡¯ç¤ºé‡‘å¹£å‹•ç•«
          localStorage.setItem('coins', coins);
          if(lightState === 'red') {
            endGame('âŒ ç´…ç‡ˆç­”å°ç§»å‹•è¢«æŠ“ï¼éŠæˆ²çµæŸ');
            return;
          }
          currentStep++;
        } else {
          currentStep = Math.max(0, currentStep - 1);
          setLight('green');
        }
        player.style.bottom = `${currentStep * stepHeight}px`;
        updateStats();
        questionArea.innerHTML = '';
        if(currentStep >= totalSteps) {
          const selectedTime = parseInt(difficultySelect.value);
          const reward = selectedTime === 60 ? 200 : selectedTime === 120 ? 70 : 30;
          coins += reward;
          localStorage.setItem('coins', coins);
          showCoinAnimation(reward);// é¡¯ç¤ºé‡‘å¹£å‹•ç•«
          updateStats();
          endGame(`ğŸ‰ æ­å–œéé—œï¼+${reward} é‡‘å¹£`);
        } else {
          showQuestion();
        }
      };
      questionArea.appendChild(btn);
    });
  }

  function saveSelectedEmoji() {
    const selected = emojiSelect.value;
    localStorage.setItem('selectedEmoji', selected);
    player.innerText = selected;
  }

  function loadSelectedEmoji() {
    const saved = localStorage.getItem('selectedEmoji');
    if(saved) {
      emojiSelect.value = saved;
      player.innerText = saved;
    }
  }

  function startTimer(seconds) {
    timeLeft = seconds;
    timerText.innerText = `å‰©é¤˜æ™‚é–“ï¼š${timeLeft} ç§’`;
    timer = setInterval(() => {
      timeLeft--;
      timerText.innerText = `å‰©é¤˜æ™‚é–“ï¼š${timeLeft} ç§’`;
      if(timeLeft <= 0) {
        clearInterval(timer);
        endGame('âŒ› æ™‚é–“åˆ°ï¼éŠæˆ²çµæŸ');
      }
    }, 1000);
  }

  function startGame() {
    controls.style.display = 'none';
    gameOver = false;
    correctCount = 0;
    totalCount = 0;
    currentStep = 0;
    stepHeight = gameArea.clientHeight / totalSteps;
    player.style.bottom = '0px';
    updateStats();
    setLight('green');
    drawGrid();
    const selectedTime = parseInt(difficultySelect.value);
    startTimer(selectedTime);
    scheduleNextLight();
    startBtn.disabled = true;
    showQuestion();
  }

  function endGame(msg) {
    gameOver = true;
    clearInterval(timer);
    statusText.innerText = msg;
    questionArea.innerHTML = '';
    setTimeout(() => {
      resetGame();
    }, 2000);
  }

  function resetGame() {
    currentStep = 0;
    player.style.bottom = '0px';
    gameOver = false;
    timerText.innerText = 'å‰©é¤˜æ™‚é–“ï¼š-';
    statusText.innerText = 'è«‹é»æ“Šé–‹å§‹ç­”é¡Œ';
    controls.style.display = 'flex';
    startBtn.disabled = false;
  }

  startBtn.addEventListener('click', startGame);
  emojiSelect.addEventListener('change', saveSelectedEmoji);
  loadSelectedEmoji();
  updateStats();
  drawGrid();

function showCoinAnimation(amount) {
  const anim = document.createElement('div');
  anim.innerText = `+${amount} ğŸ’°`;
  anim.style.position = 'absolute';
  anim.style.left = '50%';
  anim.style.bottom = `${currentStep * stepHeight + 50}px`;
  anim.style.transform = 'translateX(-50%)';
  anim.style.color = 'blue';
  anim.style.fontWeight = 'bold';
  anim.style.fontSize = '24px';
  anim.style.opacity = '1';
  anim.style.transition = 'all 1s ease-out';
  gameArea.appendChild(anim);
  setTimeout(() => {
    anim.style.bottom = `${currentStep * stepHeight + 120}px`;
    anim.style.opacity = '0';
  }, 50);
  setTimeout(() => {
    gameArea.removeChild(anim);
  }, 1050);
}

function speak(text) {
  if ('speechSynthesis' in window) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';  // è‹±æ–‡ç™¼éŸ³
    window.speechSynthesis.speak(utterance);
  }
}


</script>

</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>1 2 3 æœ¨é ­äºº - å–®å­—ç­”é¡Œç‰ˆ</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      height: 100%;
      background: #f0f0f0;
      text-align: center;
    }

    #status {
      font-size: 20px;
      margin: 5px;
    }

    #gameArea {
      width: 100vw;
      height: 60vh;
      background-color: #a3d5a3;
      position: relative;
      overflow: hidden;
      transition: background-color 0.5s;
    }

    #grid {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column-reverse;
      z-index: 0;
    }

    .grid-line {
      flex: 1;
      border-top: 1px dashed #888;
    }

    #player {
      position: absolute;
      font-size: 8vw;
      width: 10vw;
      height: 10vw;
      text-align: center;
      line-height: 10vw;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
      transition: bottom 0.2s;
    }

    #doll {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12vw;
      z-index: 3;
      transition: transform 0.3s ease;
    }

    #controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 10px;
    }

    #emojiSelect, #startBtn {
      font-size: 18px;
      padding: 10px;
      width: 70vw;
      max-width: 300px;
    }

    #questionArea {
      margin-top: 10px;
    }

    .optionBtn {
      font-size: 18px;
      padding: 8px;
      margin: 5px;
      width: 40vw;
      max-width: 200px;
    }
  </style>
</head>
<body>

<h1 style="font-size: 22px;">1ã€2ã€3 æœ¨é ­äºº ğŸŸ¢ğŸ”´ï¼ˆå–®å­—æŒ‘æˆ°ï¼‰</h1>

<div id="controls">
  <select id="emojiSelect">
    <option>ğŸ¥</option>
    <option>ğŸ±</option>
    <option>ğŸ¶</option>
    <option>ğŸ¦Š</option>
    <option>ğŸ°</option>
    <option>ğŸ¸</option>
    <option>ğŸ·</option>
    <option>ğŸµ</option>
    <option>ğŸ¯</option>
    <option>ğŸ¼</option>
  </select>
  <button id="startBtn">é–‹å§‹éŠæˆ²</button>
</div>

<div id="status">é»æ“Šé–‹å§‹ç­”é¡Œå‰é€²</div>
<div id="gameArea">
  <div id="doll">ğŸ‘§</div>
  <div id="grid"></div>
  <div id="player">ğŸ¥</div>
</div>
<div id="questionArea"></div>

<script>
  const player = document.getElementById('player');
  const doll = document.getElementById('doll');
  const statusText = document.getElementById('status');
  const startBtn = document.getElementById('startBtn');
  const emojiSelect = document.getElementById('emojiSelect');
  const gameArea = document.getElementById('gameArea');
  const grid = document.getElementById('grid');
  const questionArea = document.getElementById('questionArea');
  const controls = document.getElementById('controls');

  let lightState = 'red';
  let currentStep = 0;
  const totalSteps = 15;
  let gameOver = false;
  let stepHeight;

  const wordList = [
    { zh: "è˜‹æœ", en: "apple" }, { zh: "é¦™è•‰", en: "banana" },
    { zh: "è²“", en: "cat" }, { zh: "ç‹—", en: "dog" },
    { zh: "æ¤…å­", en: "chair" }, { zh: "æ¡Œå­", en: "table" },
    { zh: "æ›¸", en: "book" }, { zh: "æ°´", en: "water" },
    { zh: "ç«", en: "fire" }, { zh: "å±±", en: "mountain" },
    { zh: "å¤ªé™½", en: "sun" }, { zh: "æœˆäº®", en: "moon" },
    { zh: "é­š", en: "fish" }, { zh: "é³¥", en: "bird" },
    { zh: "è»Š", en: "car" }, { zh: "å·´å£«", en: "bus" },
    { zh: "æ‰‹æ©Ÿ", en: "phone" }, { zh: "é›»è…¦", en: "computer" },
    { zh: "æœ‹å‹", en: "friend" }, { zh: "å®¶åº­", en: "family" }
  ];

  function drawGrid() {
    grid.innerHTML = '';
    for (let i = 0; i < totalSteps; i++) {
      const line = document.createElement('div');
      line.className = 'grid-line';
      grid.appendChild(line);
    }
  }

  function setLight(state) {
    lightState = state;
    switch (state) {
      case 'green':
        gameArea.style.backgroundColor = '#a3d5a3';
        statusText.innerText = 'ğŸŸ¢ ç¶ ç‡ˆï¼å¿«èµ°ï¼';
        doll.innerText = 'ğŸ‘§';
        doll.style.transform = 'translateX(-50%) rotateY(180deg)';
        break;
      case 'yellow':
        gameArea.style.backgroundColor = '#ffe066';
        statusText.innerText = 'ğŸŸ¡ é»ƒç‡ˆå°å¿ƒï¼';
        doll.innerText = 'ğŸ˜';
        doll.style.transform = 'translateX(-50%) rotateY(90deg)';
        break;
      case 'red':
        gameArea.style.backgroundColor = '#ff6b6b';
        statusText.innerText = 'ğŸ”´ ç´…ç‡ˆä¸èƒ½å‹•ï¼';
        doll.innerText = 'ğŸ™…â€â™€ï¸';
        doll.style.transform = 'translateX(-50%) rotateY(0deg)';
        break;
    }
  }

  function scheduleNextLight() {
    setLight('green');
    const greenTime = Math.random() * 2000 + 1500;
    setTimeout(() => {
      setLight('yellow');
      const yellowTime = Math.random() * 2000 + 1000;
      setTimeout(() => {
        setLight('red');
        const redTime = Math.random() * 2000 + 1500;
        setTimeout(scheduleNextLight, redTime);
      }, yellowTime);
    }, greenTime);
  }

  function showQuestion() {
    questionArea.innerHTML = '';
    const question = wordList[Math.floor(Math.random() * wordList.length)];
    const correct = question.en;
    const options = [correct];
    while (options.length < 4) {
      const randomWord = wordList[Math.floor(Math.random() * wordList.length)].en;
      if (!options.includes(randomWord)) options.push(randomWord);
    }
    options.sort(() => Math.random() - 0.5);
    const qText = document.createElement('div');
    qText.innerText = `â“ã€Œ${question.zh}ã€æ˜¯ï¼Ÿ`;
    questionArea.appendChild(qText);
    options.forEach(opt => {
      const btn = document.createElement('button');
      btn.innerText = opt;
      btn.className = 'optionBtn';
      btn.onclick = () => {
        if (opt === correct) {
          if (lightState === 'red') {
            endGame('âŒ ç´…ç‡ˆç­”å°ç§»å‹•è¢«æŠ“ï¼éŠæˆ²çµæŸ');
            return;
          }
          currentStep++;
        } else {
          currentStep = Math.max(0, currentStep - 1);
          setLight('green');
        }
        player.style.bottom = `${currentStep * stepHeight}px`;
        questionArea.innerHTML = '';
        if (currentStep >= totalSteps) {
          endGame('ğŸ‰ æ­å–œéé—œï¼');
        } else {
          showQuestion();
        }
      };
      questionArea.appendChild(btn);
    });
  }

  function saveSelectedEmoji() {
    const selected = emojiSelect.value;
    localStorage.setItem('selectedEmoji', selected);
    player.innerText = selected;
  }

  function loadSelectedEmoji() {
    const saved = localStorage.getItem('selectedEmoji');
    if (saved) {
      emojiSelect.value = saved;
      player.innerText = saved;
    }
  }

  function startGame() {
    controls.style.display = 'none';
    gameOver = false;
    currentStep = 0;
    stepHeight = gameArea.clientHeight / totalSteps;
    player.style.bottom = '0px';
    setLight('green');
    drawGrid();
    scheduleNextLight();
    startBtn.disabled = true;
    showQuestion();
  }

  function endGame(msg) {
    gameOver = true;
    statusText.innerText = msg;
    questionArea.innerHTML = '';
    setTimeout(() => {
      resetGame();
    }, 1500);
  }

  function resetGame() {
    currentStep = 0;
    player.style.bottom = '0px';
    gameOver = false;
    statusText.innerText = 'è«‹é»æ“Šé–‹å§‹ç­”é¡Œ';
    controls.style.display = 'flex';
    startBtn.disabled = false;
  }

  startBtn.addEventListener('click', startGame);
  emojiSelect.addEventListener('change', saveSelectedEmoji);
  loadSelectedEmoji();
  drawGrid();
</script>
</body>
</html>
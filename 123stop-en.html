<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>1 2 3 木頭人 - 單字答題版</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      height: 100%;
      background: #f0f0f0;
      text-align: center;
    }

    #status {
      font-size: 20px;
      margin: 5px;
    }

    #gameArea {
      width: 100vw;
      height: 60vh;
      background-color: #a3d5a3;
      position: relative;
      overflow: hidden;
      transition: background-color 0.5s;
    }

    #grid {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column-reverse;
      z-index: 0;
    }

    .grid-line {
      flex: 1;
      border-top: 1px dashed #888;
    }

    #player {
      position: absolute;
      font-size: 8vw;
      width: 10vw;
      height: 10vw;
      text-align: center;
      line-height: 10vw;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
      transition: bottom 0.2s;
    }

    #doll {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12vw;
      z-index: 3;
      transition: transform 0.3s ease;
    }

    #controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 10px;
    }

    #emojiSelect, #startBtn {
      font-size: 18px;
      padding: 10px;
      width: 70vw;
      max-width: 300px;
    }

    #questionArea {
      margin-top: 10px;
    }

    .optionBtn {
      font-size: 18px;
      padding: 8px;
      margin: 5px;
      width: 40vw;
      max-width: 200px;
    }
  </style>
</head>
<body>

<h1 style="font-size: 22px;">1、2、3 木頭人 🟢🔴（單字挑戰）</h1>

<div id="controls">
  <select id="emojiSelect">
    <option>🐥</option>
    <option>🐱</option>
    <option>🐶</option>
    <option>🦊</option>
    <option>🐰</option>
    <option>🐸</option>
    <option>🐷</option>
    <option>🐵</option>
    <option>🐯</option>
    <option>🐼</option>
  </select>
  <button id="startBtn">開始遊戲</button>
</div>

<div id="status">點擊開始答題前進</div>
<div id="gameArea">
  <div id="doll">👧</div>
  <div id="grid"></div>
  <div id="player">🐥</div>
</div>
<div id="questionArea"></div>

<script>
  const player = document.getElementById('player');
  const doll = document.getElementById('doll');
  const statusText = document.getElementById('status');
  const startBtn = document.getElementById('startBtn');
  const emojiSelect = document.getElementById('emojiSelect');
  const gameArea = document.getElementById('gameArea');
  const grid = document.getElementById('grid');
  const questionArea = document.getElementById('questionArea');
  const controls = document.getElementById('controls');

  let lightState = 'red';
  let currentStep = 0;
  const totalSteps = 15;
  let gameOver = false;
  let stepHeight;

  const wordList = [
    { zh: "蘋果", en: "apple" }, { zh: "香蕉", en: "banana" },
    { zh: "貓", en: "cat" }, { zh: "狗", en: "dog" },
    { zh: "椅子", en: "chair" }, { zh: "桌子", en: "table" },
    { zh: "書", en: "book" }, { zh: "水", en: "water" },
    { zh: "火", en: "fire" }, { zh: "山", en: "mountain" },
    { zh: "太陽", en: "sun" }, { zh: "月亮", en: "moon" },
    { zh: "魚", en: "fish" }, { zh: "鳥", en: "bird" },
    { zh: "車", en: "car" }, { zh: "巴士", en: "bus" },
    { zh: "手機", en: "phone" }, { zh: "電腦", en: "computer" },
    { zh: "朋友", en: "friend" }, { zh: "家庭", en: "family" }
  ];

  function drawGrid() {
    grid.innerHTML = '';
    for (let i = 0; i < totalSteps; i++) {
      const line = document.createElement('div');
      line.className = 'grid-line';
      grid.appendChild(line);
    }
  }

  function setLight(state) {
    lightState = state;
    switch (state) {
      case 'green':
        gameArea.style.backgroundColor = '#a3d5a3';
        statusText.innerText = '🟢 綠燈！快走！';
        doll.innerText = '👧';
        doll.style.transform = 'translateX(-50%) rotateY(180deg)';
        break;
      case 'yellow':
        gameArea.style.backgroundColor = '#ffe066';
        statusText.innerText = '🟡 黃燈小心！';
        doll.innerText = '😐';
        doll.style.transform = 'translateX(-50%) rotateY(90deg)';
        break;
      case 'red':
        gameArea.style.backgroundColor = '#ff6b6b';
        statusText.innerText = '🔴 紅燈不能動！';
        doll.innerText = '🙅‍♀️';
        doll.style.transform = 'translateX(-50%) rotateY(0deg)';
        break;
    }
  }

  function scheduleNextLight() {
    setLight('green');
    const greenTime = Math.random() * 2000 + 1500;
    setTimeout(() => {
      setLight('yellow');
      const yellowTime = Math.random() * 2000 + 1000;
      setTimeout(() => {
        setLight('red');
        const redTime = Math.random() * 2000 + 1500;
        setTimeout(scheduleNextLight, redTime);
      }, yellowTime);
    }, greenTime);
  }

  function showQuestion() {
    questionArea.innerHTML = '';
    const question = wordList[Math.floor(Math.random() * wordList.length)];
    const correct = question.en;
    const options = [correct];
    while (options.length < 4) {
      const randomWord = wordList[Math.floor(Math.random() * wordList.length)].en;
      if (!options.includes(randomWord)) options.push(randomWord);
    }
    options.sort(() => Math.random() - 0.5);
    const qText = document.createElement('div');
    qText.innerText = `❓「${question.zh}」是？`;
    questionArea.appendChild(qText);
    options.forEach(opt => {
      const btn = document.createElement('button');
      btn.innerText = opt;
      btn.className = 'optionBtn';
      btn.onclick = () => {
        if (opt === correct) {
          if (lightState === 'red') {
            endGame('❌ 紅燈答對移動被抓！遊戲結束');
            return;
          }
          currentStep++;
        } else {
          currentStep = Math.max(0, currentStep - 1);
          setLight('green');
        }
        player.style.bottom = `${currentStep * stepHeight}px`;
        questionArea.innerHTML = '';
        if (currentStep >= totalSteps) {
          endGame('🎉 恭喜過關！');
        } else {
          showQuestion();
        }
      };
      questionArea.appendChild(btn);
    });
  }

  function saveSelectedEmoji() {
    const selected = emojiSelect.value;
    localStorage.setItem('selectedEmoji', selected);
    player.innerText = selected;
  }

  function loadSelectedEmoji() {
    const saved = localStorage.getItem('selectedEmoji');
    if (saved) {
      emojiSelect.value = saved;
      player.innerText = saved;
    }
  }

  function startGame() {
    controls.style.display = 'none';
    gameOver = false;
    currentStep = 0;
    stepHeight = gameArea.clientHeight / totalSteps;
    player.style.bottom = '0px';
    setLight('green');
    drawGrid();
    scheduleNextLight();
    startBtn.disabled = true;
    showQuestion();
  }

  function endGame(msg) {
    gameOver = true;
    statusText.innerText = msg;
    questionArea.innerHTML = '';
    setTimeout(() => {
      resetGame();
    }, 1500);
  }

  function resetGame() {
    currentStep = 0;
    player.style.bottom = '0px';
    gameOver = false;
    statusText.innerText = '請點擊開始答題';
    controls.style.display = 'flex';
    startBtn.disabled = false;
  }

  startBtn.addEventListener('click', startGame);
  emojiSelect.addEventListener('change', saveSelectedEmoji);
  loadSelectedEmoji();
  drawGrid();
</script>
</body>
</html>
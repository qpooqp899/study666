<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¸é‹è½‰è¼ªç›¤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style2.css">
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <!-- å·¦å´è½‰ç›¤å€åŸŸ -->
            <div class="col-lg-7 mb-4">
                <h1 class="text-center mb-4">å¹¸é‹è½‰è¼ªç›¤</h1>
                <div class="wheel-container">
                    
                    <div class="keyboard-indicator"></div>
                    <canvas id="wheel" width="400" height="400"></canvas>
                    <div id="prize-notification" class="prize-notification"></div>
                    <button id="spin-btn" class="btn btn-primary btn-lg shadow-sm">
                        <i class="bi bi-arrow-repeat me-2"></i>é–‹å§‹è½‰å‹•
                    </button>
                </div>
            </div>

            <!-- å³å´ä¸­çè¨˜éŒ„å€åŸŸ -->
            <div class="col-lg-5">
                <div class="prize-history card">
                    <div class="card-header bg-primary text-white">
                        <h2 class="mb-0 fs-5">ä¸­çç´€éŒ„</h2>
                    </div>
                    <div class="card-body">
                        <div id="prize-list" class="prize-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>

    <script>
        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spin-btn');
        const prizeList = document.getElementById('prize-list');
        
        const options = [
            'ğŸ ç¦®ç‰©', 'ğŸ’° é‡‘å¹£', 'â­ æ˜Ÿæ˜Ÿ', 'ğŸ¨ ç•«ç­†', 
            'ğŸ® éŠæˆ²', 'ğŸ“± æ‰‹æ©Ÿ', 'ğŸ’ é‘½çŸ³', 'ğŸµ éŸ³æ¨‚'
        ];
        
        let currentRotation = 0;
        let isSpinning = false;

        function drawWheel() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 150;
            const sliceAngle = (2 * Math.PI) / options.length;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            options.forEach((option, index) => {
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(
                    centerX, 
                    centerY, 
                    radius,
                    index * sliceAngle + currentRotation,
                    (index + 1) * sliceAngle + currentRotation
                );
                ctx.closePath();

                ctx.fillStyle = index % 2 ? '#FFFFFF' : 'rgb(70,165,211)';
                ctx.fill();
                ctx.strokeStyle = '#0056b3';
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(index * sliceAngle + sliceAngle / 2 + currentRotation);
                ctx.textAlign = 'right';
                ctx.fillStyle = index % 2 ? '#000000' : '#FFFFFF';
                ctx.font = 'bold 20px Arial';
                ctx.rotate(Math.PI);
                ctx.fillText(option, -radius + 80, 0);
                ctx.restore();
            });

            ctx.beginPath();
            ctx.arc(centerX, centerY, 15, 0, 2 * Math.PI);
            ctx.fillStyle = '#0056b3';
            ctx.fill();
        }

        function getWinningPrize(rotation) {
            
          
            // å°‡æ—‹è½‰è§’åº¦æ¨™æº–åŒ–åˆ° 0 åˆ° 2Ï€ ä¹‹é–“
            const normalizedRotation = rotation % (2 * Math.PI);
            console.log('æ¨™æº–åŒ–å¾Œçš„è§’åº¦ normalizedRotation:', normalizedRotation);
            console.log('æ¨™æº–åŒ–å¾Œçš„è§’åº¦(åº¦æ•¸):', (normalizedRotation * 180 / Math.PI).toFixed(2) + 'Â°');

            // è¨ˆç®—æ¯å€‹çé …æ‰€å çš„è§’åº¦
            const sliceAngle = (2 * Math.PI) / options.length;
            console.log('æ¯å€‹çé …çš„è§’åº¦ sliceAngle:', sliceAngle);
            console.log('æ¯å€‹çé …çš„è§’åº¦(åº¦æ•¸):', (sliceAngle * 180 / Math.PI).toFixed(2) + 'Â°');

            // è¨ˆç®—æŒ‡é‡æŒ‡å‘çš„å€å¡Šç´¢å¼•
            const index = Math.floor(normalizedRotation / sliceAngle);
            console.log('ç•¶å‰å€å¡Šç´¢å¼• index:', index);

            // è¨ˆç®—æœ€çµ‚çé …ç´¢å¼•
            const finalIndex = (options.length - index) % options.length;
            console.log('æœ€çµ‚çé …ç´¢å¼• finalIndex:', finalIndex);
            console.log('ä¸­çé …ç›®:', options[finalIndex]);

            return options[finalIndex];
        }

        function addPrizeToHistory(prize) {
            const prizeItem = document.createElement('div');
            prizeItem.className = 'prize-item';
            const time = new Date().toLocaleTimeString();
            prizeItem.innerHTML = `<span>${time}</span> - ${prize}`;
            prizeList.insertBefore(prizeItem, prizeList.firstChild);

            if (prizeList.children.length > 10) {
                prizeList.removeChild(prizeList.lastChild);
            }
        }

        function spin() {
            if (isSpinning) return;
            isSpinning = true;

            const spinDuration = 3000;
            const startRotation = currentRotation;
            const totalRotation = -(2 * Math.PI * 5 + Math.random() * 2 * Math.PI);
            const startTime = Date.now();

            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / spinDuration, 1);

                const easeOut = 1 - Math.pow(1 - progress, 3);
                currentRotation = startRotation + totalRotation * easeOut;

                drawWheel();

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    isSpinning = false;
                    const prize = getWinningPrize(currentRotation);
                    showPrizeNotification(prize);
                    addPrizeToHistory(prize);
                }
            }

            animate();
        }

        function showPrizeNotification(prize) {
            const notification = document.getElementById('prize-notification');
            notification.textContent = `æ­å–œç²å¾—ï¼š${prize}`;
            notification.classList.add('show');

            // 3ç§’å¾Œæ·¡å‡º
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        drawWheel();
        spinBtn.addEventListener('click', spin);

        const displayBox = document.getElementById('displayBox');
        document.querySelectorAll('.emoji-option').forEach(option => {
            option.addEventListener('click', function() {
                displayBox.textContent = this.textContent;
            });
        });
    </script>
</body>
</html>

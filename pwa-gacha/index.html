<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è›‹ä»”æ‰­è›‹æ©Ÿ</title>

  <style>
    body {
      font-family: sans-serif;
      background: #fffde7;
      color: #2d3436;
      padding: 20px;
      text-align: center;
    }
    h1 { font-size: 32px; }
    button { padding: 10px 20px; margin: 10px; font-size: 18px; }
    select { font-size: 16px; }
    #history, #collection, #shop, #shareImg { margin-top: 30px; text-align: left; }
    ul { list-style: none; padding: 0; }
    li { margin: 5px 0; cursor: pointer; }
    canvas { border: 1px solid #ccc; margin-top: 20px; }

    #menu-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: #ffcc00;
      border: none;
      border-radius: 10px;
      font-size: 24px;
      padding: 5px 10px;
      cursor: pointer;
    }

    #menu {
      position: fixed;
      top: 60px;
      right: 10px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      z-index: 999;
      display: none;
    }
    #menu button {
      display: block;
      width: 100%;
      margin-bottom: 5px;
    }

    #gachaAnimation {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .card-flip, .card-show {
      width: 120px;
      height: 140px;
      font-size: 48px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      border-radius: 10px;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 10px;
    }

    .card-flip {
      animation: spin 1s linear infinite;
    }

    .card-show {
      animation: popIn 0.5s ease-out forwards;
    }

    .rare-glow {
      box-shadow: 0 0 15px 5px gold;
      background: #fff8dc;
    }

    .gray-icon {
    filter: grayscale(100%);
  opacity: 0.4;
    }

    @keyframes spin {
      0% { transform: rotateY(0deg); }
      100% { transform: rotateY(360deg); }
    }

    @keyframes popIn {
      0% { opacity: 0; transform: scale(0.3); }
      100% { opacity: 1; transform: scale(1); }
    }

    #modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #modal img {
      max-width: 80vw;
      max-height: 80vh;
      border: 10px solid white;
      border-radius: 10px;
      background: white;
    }
    @keyframes sparkle {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.3; transform: scale(1.2); }
}
.star-effect::after {
  content: "âœ¨";
  position: absolute;
  top: -10px;
  right: -10px;
  animation: sparkle 1s infinite;
  font-size: 24px;
}
.card-show {
  position: relative; /* ç‚ºæ˜Ÿæ˜Ÿå‹•ç•«å®šä½æº–å‚™ */
}

  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f2f5;
    padding: 20px;
  }

  #menu-toggle {
    font-size: 24px;
    padding: 8px 15px;
    border: none;
    background: #4a90e2;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(74, 144, 226, 0.5);
    transition: background-color 0.3s ease;
  }
  #menu-toggle:hover {
    background: #357ABD;
  }



  #menu button {
    background: #fff;
    border: 2px solid #4a90e2;
    color: #4a90e2;
    padding: 8px 14px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 2px 5px rgb(74 144 226 / 0.3);
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  #menu button:hover {
    background: #4a90e2;
    color: white;
  }

  label {
    display: inline-block;
    margin: 15px 0 8px 0;
    font-weight: 600;
    font-size: 16px;
    color: #333;
  }

  select#poolSelect {
    padding: 5px 10px;
    border-radius: 6px;
    border: 1.5px solid #4a90e2;
    font-size: 15px;
    cursor: pointer;
    outline-offset: 2px;
  }

  #coinDisplay {
    font-weight: 700;
    color: #ff9800;
    font-size: 18px;
    margin-left: 6px;
  }

  .draw-buttons {
    margin-top: 15px;
    display: flex;
    gap: 15px;
  }

  .draw-buttons button {
    flex: 1;
    font-size: 18px;
    font-weight: 700;
    background: linear-gradient(135deg, #f6b93b, #e58e26);
    border: none;
    padding: 12px 0;
    border-radius: 12px;
    color: white;
    cursor: pointer;
    box-shadow: 0 6px 10px rgba(229, 142, 38, 0.6);
    transition: background 0.4s ease;
  }
  .draw-buttons button:hover {
    background: linear-gradient(135deg, #e58e26, #f6b93b);
  }
</style>

  </style>
</head>
<body>
 <a href="../index.html" style="position:absolute;left:10px;top:10px;font-size:24px;text-decoration:none;background:#eee;padding:6px 18px;border-radius:8px;color:#222;box-shadow:0 2px 6px #ccc;">â† è¿”å›é¸å–®</a>

  <h1>ğŸ´ è›‹ä»”æ‰­è›‹æ©Ÿ</h1>

 <button id="menu-toggle" onclick="toggleMenu()">â˜°</button>

<div id="menu">
  <button onclick="openCollectionModal()">ğŸ“ å¡ç‰‡åœ–é‘‘</button>
  <!-- <button onclick="openShop()">ğŸ¬ è£é£¾å•†åŸ</button> -->
  <button onclick="checkDailyReward()">ğŸ—“ï¸ æ¯æ—¥ç°½åˆ°</button>
</div>

<label for="poolSelect">é¸æ“‡å¡æ± ï¼š</label>
<select id="poolSelect" name="poolSelect">
  <option value="normal">æ™®é€šå¡æ± </option>
  <option value="limited">é™å®šå¡æ± </option>
</select>

<div style="margin-top: 10px;">
  ğŸ’° é‡‘å¹£ï¼š<span id="coinDisplay">0</span>
</div>

<div class="draw-buttons">
  <button onclick="drawCardWithPity(document.getElementById('poolSelect').value)">æŠ½ä¸€å¼µï¼ğŸ² 50é‡‘å¹£</button>
  <button onclick="drawTenCards()">æŠ½åæ¬¡ï¼ğŸ¥ 450é‡‘å¹£</button>
</div>


    <div id="gachaAnimation"></div>

<div id="collectionModal" style="
  display:none;
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  border-radius: 10px;
  max-height: 80vh;
  width: 90vw;
  max-width: 600px;
  overflow-y: auto;
  box-shadow: 0 0 15px rgba(0,0,0,0.3);
  padding: 20px;
  z-index: 10000;
">
  <button style="float:right;" onclick="closeCollectionModal()"> âœ–</button>
  <div id="collectionContent"></div>
</div>

  <div id="history"></div>

  <div id="shop"></div>
  <div id="shareImg"></div>
  <div id="modal" onclick="this.style.display='none'"><img id="modalImg"></div>

  <script>
    const pools = {
      normal: [
        { name: "å°è—", rarity: "ä¸€èˆ¬", icon: "img/å°è—.png" },
          { name: "å°è—2", rarity: "ä¸€èˆ¬", icon: "img/å°è—2.png" },
            { name: "å°ç¶ ", rarity: "ä¸€èˆ¬", icon: "img/å°ç¶ .png" },
              { name: "å°é»ƒ", rarity: "ä¸€èˆ¬", icon: "img/å°é»ƒ.png" },
                { name: "å°é»‘", rarity: "ä¸€èˆ¬", icon: "img/å°é»‘.png" },
                 { name: "å°ç²‰", rarity: "ä¸€èˆ¬", icon: "img/å°ç²‰.png" },
                 { name: "ç†ŠçŒ«ä¿è‚²å‘˜", rarity: "ç¨€æœ‰", icon: "img/ç†ŠçŒ«ä¿è‚²å‘˜.png" },
                  { name: "å°è±¡å“†å“†", rarity: "ç¨€æœ‰", icon: "img/å°è±¡å“†å“†.png" },
                   { name: "æœºæ¢°å¸ˆç»´è¿ª", rarity: "ç¨€æœ‰", icon: "img/æœºæ¢°å¸ˆç»´è¿ª.png" },
                    { name: "èŒ¨çƒ", rarity: "ç¨€æœ‰", icon: "img/èŒ¨çƒ.png" },
                     { name: "å‘†å‘†é¸Ÿ", rarity: "ç¨€æœ‰", icon: "img/å‘†å‘†é¸Ÿ.png" },
                      { name: "æ©™ç•™é¦™", rarity: "ç¨€æœ‰", icon: "img/æ©™ç•™é¦™.png" },
                       { name: "å¤±å¿ƒç†Š", rarity: "ç¨€æœ‰", icon: "img/å¤±å¿ƒç†Š.png" },
                        { name: "åœ†åœ†å­", rarity: "ç¨€æœ‰", icon: "img/åœ†åœ†å­.png" },
                         { name: "æœºæ¢°é¼“æ‰‹è´å…‹", rarity: "ç¨€æœ‰", icon: "img/æœºæ¢°é¼“æ‰‹è´å…‹.png" },
        { name: "åˆå¤œéµ", rarity: "ç¨€æœ‰", icon: "img/åˆå¤œéµ.png" },
          { name: "æœˆçœ ç¡è¡£", rarity: "ç¨€æœ‰", icon: "img/æœˆçœ ç¡è¡£.png" },
            { name: "æ˜Ÿå¤¢ç¡è¡£", rarity: "ç¨€æœ‰", icon: "img/æ˜Ÿå¤¢ç¡è¡£.png" },
              { name: "ä¸»å”±æ›œæ˜Ÿ", rarity: "ç¨€æœ‰", icon: "img/ä¸»å”±æ›œæ˜Ÿ.png" },
                { name: "æ˜Ÿé›²å’©å’©", rarity: "ç¨€æœ‰", icon: "img/æ˜Ÿé›²å’©å’©.png" },
                  { name: "æš–é™½ç¡è¡£", rarity: "ç¨€æœ‰", icon: "img/æš–é™½ç¡è¡£.png" },
                    { name: "è©­ç›®é­”è¡“å¸«", rarity: "ç¨€æœ‰", icon: "img/è©­ç›®é­”è¡“å¸«.png" },
                        { name: "èª¿é£²å¸«è¾è¾", rarity: "ç¨€æœ‰", icon: "img/èª¿é£²å¸«è¾è¾.png" },
                            { name: "è‰è“å†°", rarity: "ç¨€æœ‰", icon: "img/è‰è“å†°.png" },
                              { name: "åŒ—æ¥µå…”ç›§ç±³", rarity: "ç¨€æœ‰", icon: "img/åŒ—æ¥µå…”ç›§ç±³.png" },
                                { name: "æ„›éº—çµ²", rarity: "ç¨€æœ‰", icon: "img/æ„›éº—çµ².png" },
                                 { name: "éƒé‡‘é¦™è²çˆ¾", rarity: "ç¨€æœ‰", icon: "img/éƒé‡‘é¦™è²çˆ¾.png" },
        { name: "ç‰é¾æ‰¶é¢¨", rarity: "è¶…ç¨€æœ‰", icon: "img/ç‰é¾æ‰¶é¢¨.png" },
        { name: "æ•å¤¢è»Ÿè»Ÿ", rarity: "è¶…ç¨€æœ‰", icon: "img/æ•å¤¢è»Ÿè»Ÿ.png" },
               { name: "å½©è™¹é­”å¥³", rarity: "è¶…ç¨€æœ‰", icon: "img/å½©è™¹é­”å¥³.png" },
        { name: "ç½²å…‰é¾å¥³èŠ™ç‘", rarity: "è¶…ç¨€æœ‰", icon: "img/ç½²å…‰é¾å¥³èŠ™ç‘.png" },
      { name: "æ–·ç½ªé¨å£«", rarity: "è¶…ç¨€æœ‰", icon: "img/æ–·ç½ªé¨å£«.png" },
      ],
      limited: [
        { name: "å‰ä»–æ‰‹å¡è˜¿", rarity: "é™å®š", icon: "img/å‰ä»–æ‰‹å¡è˜¿.png" },
        { name: "å°èŠ™å†°éœœéœœ", rarity: "é™å®š", icon: "img/å°èŠ™å†°éœœéœœ.png" },
        { name: "å¤ªç©ºèˆ¹é•¿è´è´", rarity: "é™å®š", icon: "img/å¤ªç©ºèˆ¹é•¿è´è´.png" },
        { name: "æ¸©æ³‰åº—é•¿é˜¿ç§‹", rarity: "é™å®š", icon: "img/æ¸©æ³‰åº—é•¿é˜¿ç§‹.png" },
        { name: "å›°å›°æ˜Ÿäººå¥—è£…", rarity: "é™å®š", icon: "img/å›°å›°æ˜Ÿäººå¥—è£….png" },
        { name: "ç”œæ¢¦çƒ­ç‰›å¥¶", rarity: "é™å®š", icon: "img/ç”œæ¢¦çƒ­ç‰›å¥¶.png" },
         { name: "èœœé›ªå†°åŸ", rarity: "é™å®š", icon: "img/èœœé›ªå†°åŸ.png" },
      ]
    };

    function toggleMenu() {
      const menu = document.getElementById("menu");
      menu.style.display = menu.style.display === "none" || !menu.style.display ? "block" : "none";
    }

    // å–®æŠ½
  function drawCardWithPity(poolType = "normal") {

    let coins = parseInt(localStorage.getItem("coins") || "0");
  if (coins < 50) {
    alert("é‡‘å¹£ä¸è¶³ï¼å–®æŠ½éœ€è¦50é‡‘å¹£ï¼");
    return;
  }
  updateCoins(-50); // æ‰£50é‡‘å¹£

  let pityCounter = parseInt(localStorage.getItem("pity") || "0");
  const pool = pools[poolType];
  const superRareItems = pool.filter(i => i.rarity === "è¶…ç¨€æœ‰");
  let drawnItem;

  if (pityCounter >= 100 && superRareItems.length > 0) {
    drawnItem = superRareItems[Math.floor(Math.random() * superRareItems.length)];
    pityCounter = 0;
  } else {
    drawnItem = getRandomItemByRarity(pool);
    pityCounter = drawnItem.rarity === "è¶…ç¨€æœ‰" ? 0 : pityCounter + 1;
  }

  localStorage.setItem("pity", pityCounter);
  const fragments = saveDrawHistory(drawnItem);
  showGachaAnimation([drawnItem]);
  showShareImage(drawnItem, fragments);
}


    // åé€£æŠ½
  function drawTenCards() {

      let coins = parseInt(localStorage.getItem("coins") || "0");
  if (coins < 450) {
    alert("é‡‘å¹£ä¸è¶³ï¼åé€£æŠ½éœ€è¦450é‡‘å¹£ï¼");
    return;
  }
  updateCoins(-450); // æ‰£450é‡‘å¹£

  const poolType = document.getElementById('poolSelect').value;
  const pool = pools[poolType];
  const results = [];
  let totalFragments = 0;
  let pityCounter = parseInt(localStorage.getItem("pity") || "0");
  const superRareItems = pool.filter(i => i.rarity === "è¶…ç¨€æœ‰");

  for (let i = 0; i < 10; i++) {
    let drawnItem;
    if (pityCounter >= 100 && superRareItems.length > 0) {
      drawnItem = superRareItems[Math.floor(Math.random() * superRareItems.length)];
      pityCounter = 0;
    } else {
      drawnItem = getRandomItemByRarity(pool);
      pityCounter = drawnItem.rarity === "è¶…ç¨€æœ‰" ? 0 : pityCounter + 1;
    }
    const frag = saveDrawHistory(drawnItem);
    totalFragments += frag;
    results.push(drawnItem);
  }

  localStorage.setItem("pity", pityCounter);
  showGachaAnimation(results);
  showShareImage(results[0], totalFragments);
}


    function getRandomItemByRarity(pool) {
  // è¨­å®šç¨€æœ‰åº¦æ©Ÿç‡
  const rarityRates = {
    "è¶…ç¨€æœ‰": 0.01,
    "ç¨€æœ‰": 0.19,
    "ä¸€èˆ¬": 0.80
  };

  // å°‡æ©Ÿç‡å±•é–‹ç‚ºå€é–“ç¯„åœ
  const rand = Math.random();
  let cumulative = 0;
  let selectedRarity = "ä¸€èˆ¬";

  for (const [rarity, rate] of Object.entries(rarityRates)) {
    cumulative += rate;
    if (rand < cumulative) {
      selectedRarity = rarity;
      break;
    }
  }

  // å¾ç¬¦åˆç¨€æœ‰åº¦çš„é …ç›®ä¸­éš¨æ©Ÿé¸æ“‡
  const filtered = pool.filter(item => item.rarity === selectedRarity);
  if (filtered.length > 0) {
    return filtered[Math.floor(Math.random() * filtered.length)];
  } else {
    // å¦‚æœè©²ç¨€æœ‰åº¦æ²’æœ‰ç‰©å“ï¼Œå°± fallback éš¨æ©Ÿä¸€å€‹
    return pool[Math.floor(Math.random() * pool.length)];
  }
}


function showGachaAnimation(items) {
  const animDiv = document.getElementById("gachaAnimation");
  animDiv.innerHTML = "";
  const owned = JSON.parse(localStorage.getItem("gachaOwned") || "{}");

  items.forEach((item, i) => {
    const div = document.createElement("div");
    div.className = "card-flip";
    div.textContent = "ğŸ";
    animDiv.appendChild(div);

    setTimeout(() => {
      div.className = "card-show";
      div.innerHTML = `<img src="${item.icon}" width="80" onclick="showModal('${item.icon}')">`;

      // åŠ ä¸Šç‰¹æ•ˆ
      if (item.rarity === "è¶…ç¨€æœ‰") {
        div.classList.add("rare-glow", "star-effect");
      }

      // é¡¯ç¤º NEW æ¨™ç±¤
      if (!owned[item.name]) {
        const newTag = document.createElement("div");
        newTag.textContent = "NEW!";
        newTag.style = "position:absolute;top:5px;left:5px;background:red;color:white;padding:2px 4px;border-radius:5px;font-size:12px;";
        div.appendChild(newTag);
        owned[item.name] = true;
        localStorage.setItem("gachaOwned", JSON.stringify(owned));
      }
    }, 500 + i * 300);
  });
}


    function saveDrawHistory(item) {
      const history = JSON.parse(localStorage.getItem("gachaHistory") || "[]");
      const duplicates = history.filter(h => h.name === item.name).length;
      let fragmentsGained = 0;
      if (duplicates > 0) {
        const fragments = parseInt(localStorage.getItem("fragments") || "0");
        fragmentsGained = 1;
        localStorage.setItem("fragments", fragments + 1);
      }
      history.push({ ...item, time: Date.now() });
      localStorage.setItem("gachaHistory", JSON.stringify(history));
      updateCollection();
      return fragmentsGained;
    }

function updateCollection() {
  const history = JSON.parse(localStorage.getItem("gachaHistory") || "[]");
  const owned = {};
  history.forEach(item => owned[item.name] = item);
  const allItems = [...pools.normal, ...pools.limited];

  let html = `<h2>ğŸ† å¡ç‰‡åœ–é‘‘</h2><p>ç¢ç‰‡æ•¸ï¼š${localStorage.getItem("fragments") || 0}</p><ul style="list-style:none; padding:0;">`;
  allItems.forEach(item => {
    const hasItem = owned[item.name];
    html += `<li style="margin:5px; cursor:pointer;" onclick="showModal('${item.icon}')">
      <img src="${item.icon}" width="40" class="${hasItem ? '' : 'gray-icon'}" style="vertical-align:middle; border-radius:5px;">
      <span style="margin-left:10px; vertical-align:middle;">
        ${item.name}ï¼ˆ${item.rarity}ï¼‰
      </span>
    </li>`;
  });
  html += "</ul>";

  document.getElementById("collectionContent").innerHTML = html;
}

 // æ‰“é–‹åœ–é‘‘æ¨¡æ…‹æ¡†
function openCollectionModal() {
  const modal = document.getElementById("collectionModal");
  modal.style.display = "block";
  updateCollection(); // æ›´æ–°åœ–é‘‘å…§å®¹
}

function closeCollectionModal() {
  document.getElementById("collectionModal").style.display = "none";
}


    function showModal(src) {
      document.getElementById("modalImg").src = src;
      document.getElementById("modal").style.display = 'flex';
    }

    function showShareImage(item, fragments) {
      const msg = `ğŸ‰ æŠ½ä¸­ï¼š${item.name}ï¼ˆ${item.rarity}ï¼‰${fragments ? `\nğŸ’ é‡è¤‡ç²å¾— +${fragments} ç¢ç‰‡ï¼` : ''}`;
      document.getElementById("shareImg").innerText = msg;
    }

    //ç°¡å–®ç°½åˆ°å‡½æ•¸
    function checkDailyReward() {
  const today = new Date().toDateString();
  const lastCheck = localStorage.getItem("lastDaily") || "";
  if (today === lastCheck) {
    alert("ä»Šå¤©å·²ç°½åˆ°éå›‰ï¼");
  } else {
    localStorage.setItem("lastDaily", today);
    const fragments = parseInt(localStorage.getItem("fragments") || "0");
    localStorage.setItem("fragments", fragments + 2); // ç°½åˆ°é€2ç¢ç‰‡
    alert("ç°½åˆ°æˆåŠŸï¼ç²å¾—2ç¢ç‰‡ ğŸ’");
    updateCollection();
  }
}
//å•†åŸï¼ˆopenShopï¼‰
function openShop() {
  const shopEl = document.getElementById("shop");
  shopEl.innerHTML = `
    <h2>ğŸ¬ è£é£¾å•†åŸ</h2>
    <p>å°šæœªé–‹æ”¾ï¼Œæ•¬è«‹æœŸå¾…ï¼</p>
  `;
}

function updateCoins(amount) {
  let coins = parseInt(localStorage.getItem("coins") || "0");
  coins += amount;
  if (coins < 0) coins = 0; // ä¸è®“é‡‘å¹£è®Šæˆè² æ•¸
  localStorage.setItem("coins", coins);
  document.getElementById("coinDisplay").innerText = coins;
}


window.onload = function () {
  let coins = parseInt(localStorage.getItem('coins'));
  if (isNaN(coins)) coins = 0; // é è¨­ 100 é‡‘å¹£
  localStorage.setItem('coins', coins);
  document.getElementById("coinDisplay").innerText = coins;
};


  </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>å½ˆå‡ºå–®å­— Moon Blaster</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
    }
    canvas {
      background: #111;
      display: block;
      margin: 0 auto;
      max-width: 100%;
      height: auto;
      touch-action: none;
    }
    h2 {
      margin: 10px 0;
    }
  </style>
</head>
<body>
        <a href="../index.html" style="position:absolute;left:10px;top:10px;font-size:24px;text-decoration:none;background:#eee;padding:6px 18px;border-radius:8px;color:#222;box-shadow:0 2px 6px #ccc;">â† è¿”å›é¸å–®</a>

    <div id="coinBar">
  <div id="coinIcon">ğŸ’°</div>
  <div id="coinDisplay">0</div>
</div>
<label for="speedRange">ç™¼éŸ³é€Ÿåº¦: <span id="speedValue">0.5</span></label>
<input type="range" id="speedRange" min="0.1" max="2" step="0.1" value="0.5" />

  <h2 id="questionTitle">è«‹æ‰¾å‡ºï¼šæœˆäº® çš„è‹±æ–‡</h2>
  <canvas id="gameCanvas" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const questionTitle = document.getElementById("questionTitle");

const questionSet = [
  { question: "æœˆäº®", answer: "moon", options: ["moon", "sun", "star", "cloud"] },
  { question: "å¤ªé™½", answer: "sun", options: ["sun", "rain", "snow", "sky"] },
  { question: "è²“", answer: "cat", options: ["dog", "cat", "cow", "pig"] },
  { question: "è˜‹æœ", answer: "apple", options: ["apple", "grape", "banana", "peach"] },
  { question: "ç‹—", answer: "dog", options: ["dog", "cat", "mouse", "bird"] },
  { question: "é­š", answer: "fish", options: ["fish", "frog", "duck", "turtle"] },
  { question: "é³¥", answer: "bird", options: ["cat", "bird", "lion", "wolf"] },
  { question: "æ¨¹", answer: "tree", options: ["tree", "flower", "grass", "leaf"] },
  { question: "è»Š", answer: "car", options: ["bus", "car", "bike", "truck"] },
  { question: "æ°´", answer: "water", options: ["water", "milk", "juice", "tea"] },
  { question: "æ›¸", answer: "book", options: ["pen", "book", "notebook", "paper"] },
  { question: "é›»è…¦", answer: "computer", options: ["computer", "phone", "camera", "tablet"] },
  { question: "å®¶", answer: "house", options: ["house", "hotel", "school", "shop"] },
  { question: "é›¨", answer: "rain", options: ["sun", "rain", "snow", "cloud"] },
  { question: "é›ª", answer: "snow", options: ["snow", "rain", "fog", "wind"] },
  { question: "èŠ±", answer: "flower", options: ["flower", "grass", "tree", "leaf"] },
  { question: "è‰", answer: "grass", options: ["grass", "leaf", "flower", "tree"] },
  { question: "é›»è©±", answer: "phone", options: ["phone", "computer", "radio", "tv"] },
  { question: "æ¤…å­", answer: "chair", options: ["table", "chair", "bed", "sofa"] },
  { question: "æ²™ç™¼", answer: "sofa", options: ["chair", "sofa", "bed", "couch"] },
  { question: "åºŠ", answer: "bed", options: ["bed", "table", "chair", "desk"] },
  { question: "é›»è¦–", answer: "tv", options: ["tv", "radio", "computer", "phone"] },
  { question: "å†°ç®±", answer: "fridge", options: ["fridge", "oven", "microwave", "toaster"] },
  { question: "æ´—è¡£æ©Ÿ", answer: "washing machine", options: ["washing machine", "dryer", "dishwasher", "vacuum cleaner"] },
  { question: "å»šæˆ¿", answer: "kitchen", options: ["kitchen", "bathroom", "living room", "bedroom"] },
  { question: "æµ´å®¤", answer: "bathroom", options: ["bathroom", "kitchen", "living room", "bedroom"] },
  { question: "æ›¸æˆ¿", answer: "study room", options: ["study room", "bedroom", "living room", "kitchen"] },
  { question: "è¾¦å…¬å®¤", answer: "office", options: ["office", "school", "library", "store"] },  
  { question: "æ¡Œå­", answer: "table", options: ["chair", "table", "desk", "bench"] },
    { question: "é–€", answer: "door", options: ["door", "window", "gate", "fence"] },
    { question: "çª—æˆ¶", answer: "window", options: ["window", "door", "wall", "roof"] },
    { question: "ç‰†å£", answer: "wall", options: ["wall", "floor", "ceiling", "roof"] },
    { question: "å±‹é ‚", answer: "roof", options: ["roof", "wall", "floor", "ceiling"] },
    { question: "åœ°æ¿", answer: "floor", options: ["floor", "ceiling", "wall", "roof"] },
    { question: "ç‡ˆ", answer: "light", options: ["light", "lamp", "bulb", "candle"] },
    { question: "é›»æ¢¯", answer: "elevator", options: ["elevator", "staircase", "escalator", "ramp"] },
    { question: "æ¨“æ¢¯", answer: "stairs", options: ["stairs", "elevator", "escalator", "ramp"] },
    { question: "é›»æ¢¯é–“", answer: "elevator shaft", options: ["elevator shaft", "staircase", "escalator", "ramp"] },
    { question: "èµ°å»Š", answer: "hallway", options: ["hallway", "corridor", "passageway", "aisle"] },
    { question: "èµ°é“", answer: "aisle", options: ["aisle", "hallway", "corridor", "passageway"] },
    { question: "å¤©èŠ±æ¿", answer: "ceiling", options: ["ceiling", "floor", "wall", "roof"] },
    { question: "åœ°æ¯¯", answer: "carpet", options: ["carpet", "rug", "mat", "tile"] },
    { question: "ç“·ç£š", answer: "tile", options: ["tile", "marble", "granite", "stone"] },
    { question: "æœ¨åœ°æ¿", answer: "wood floor", options: ["wood floor", "laminate floor", "vinyl floor", "tile floor"] },
    { question: "é‹ªåœ°æ¿", answer: "flooring", options: ["flooring", "carpet", "tile", "wood"] },
    { question: "ç‰†ç´™", answer: "wallpaper", options: ["wallpaper", "paint", "plaster", "paneling"] },
    { question: "æ²¹æ¼†", answer: "paint", options: ["paint", "stain", "varnish", "sealant"] },
    { question: "è£é£¾", answer: "decoration", options: ["decoration", "ornament", "accessory", "furnishing"] },
    { question: "è£é£¾å“", answer: "ornament", options: ["ornament", "decoration", "accessory", "furnishing"] },
    { question: "é…ä»¶", answer: "accessory", options: ["accessory", "decoration", "ornament", "furnishing"] },
    { question: "å‚¢ä¿±", answer: "furniture", options: ["furniture", "fixture", "appliance", "equipment"] },
    { question: "è£ç½®", answer: "fixture", options: ["fixture", "furniture", "appliance", "equipment"] },
    { question: "é›»å™¨", answer: "appliance", options: ["appliance", "device", "gadget", "tool"] },
    { question: "è¨­å‚™", answer: "equipment", options: ["equipment", "gear", "machinery", "tools"] },
    { question: "å·¥å…·", answer: "tool", options: ["tool", "instrument", "implement", "utensil"] },
    { question: "æ¨‚å™¨", answer: "instrument", options: ["instrument", "tool", "device", "gadget"] },
    { question: "é¤å…·", answer: "utensil", options: ["utensil", "cutlery", "silverware", "tableware"] },
    { question: "é¤å…·", answer: "cutlery", options: ["cutlery", "utensil", "silverware", "tableware"] },
    { question: "é¤å…·", answer: "silverware", options: ["silverware", "utensil", "cutlery", "tableware"] },
    { question: "é¤å…·", answer: "tableware", options: ["tableware", "utensil", "cutlery", "silverware"] },
    { question: "æ¯å­", answer: "cup", options: ["cup", "glass", "mug", "bottle"] },
    { question: "ç»ç’ƒæ¯", answer: "glass", options: ["glass", "cup", "mug", "bottle"] },
    { question: "é¦¬å…‹æ¯", answer: "mug", options: ["mug", "cup", "glass", "bottle"] },
    { question: "ç“¶å­", answer: "bottle", options: ["bottle", "cup", "glass", "mug"] },
    { question: "ç¢—ç¢Ÿ", answer: "dishware", options: ["dishware", "tableware", "utensil", "cutlery"] },
    { question: "é¤ç›¤", answer: "plate", options: ["plate", "bowl", "cup", "glass"] },
    { question: "ç¢—ç¢Ÿçµ„åˆ", answer: "dinnerware set", options: ["dinnerware set", "dish set", "table setting set"] },
    { question: "é¤å…·çµ„åˆ", answer: "cutlery set", options: ["cutlery set","silverware set","utensil set","flatware set"] },
    { question: "é¤å…·", answer: "flatware", options: ["flatware", "cutlery", "silverware", "utensil"] },
    { question: "é¤å·¾", answer: "napkin", options: ["napkin", "towel", "cloth", "paper"] },    
    { question: "æ¡Œå¸ƒ", answer: "tablecloth", options: ["tablecloth", "placemat", "table runner", "table mat"] },   
    { question: "é¤æ¡Œ", answer: "dining table", options: ["dining table", "coffee table", "side table", "console table"] },
    { question: "æ¤…å­", answer: "chair", options: ["chair", "stool", "bench", "armchair"] },
    { question: "æ²™ç™¼", answer: "sofa", options: ["sofa", "couch", "loveseat", "sectional"] },
    { question: "åºŠ", answer: "bed", options: ["bed", "mattress", "bunk bed", "loft bed"] },
    { question: "æ›¸æ¡Œ", answer: "desk", options: ["desk", "workstation", "vanity", "console"] },
    { question: "æ›¸æ«ƒ", answer: "bookshelf", options: ["bookshelf", "bookcase", "library shelf", "display shelf"] },
    { question: "è¡£æ«ƒ", answer: "wardrobe", options: ["wardrobe", "closet", "armoire", "cabinet"] },
    { question: "æŠ½å±œæ«ƒ", answer: "chest of drawers", options: ["chest of drawers","dresser","bureau","cabinet"] },
    { question: "é›»è¦–æ«ƒ", answer: "TV stand", options: ["TV stand","entertainment center","media console","AV cabinet"] },
    { question: "å’–å•¡æ¡Œ", answer: "coffee table", options: ["coffee table","end table","side table","accent table"] },
    { question: "é‚Šæ¡Œ", answer: "side table", options: ["side table","end table","accent table","console table"] },
    { question: "é¤æ¤…", answer: "dining chair", options: ["dining chair","kitchen chair","bar stool","counter stool"] },
    { question: "å§å°æ¤…", answer: "bar stool", options: ["bar stool","counter stool","kitchen stool","pub stool"] },
    { question: "æ–æ¤…", answer: "rocking chair", options: ["rocking chair","glider chair","recliner","swivel chair"] },
    { question: "æ–æ¤…", answer: "recliner", options: ["recliner","rocking chair","glider chair","swivel chair"] },
    { question: "è½‰æ¤…", answer: "swivel chair", options: ["swivel chair","rolling chair","task chair","office chair"] },
    { question: "è¾¦å…¬æ¤…", answer: "office chair", options: ["office chair","task chair","executive chair","manager chair"] },
    { question: "èººæ¤…", answer: "lounge chair", options: ["lounge chair","chaise lounge","sun lounger","deck chair"] },
    { question: "æ²™ç™¼åºŠ", answer: "sofa bed", options: ["sofa bed","futon","daybed","pull-out couch"] },
    { question: "æŠ˜ç–Šæ¤…", answer: "folding chair", options: ["folding chair","camping chair","portable chair","beach chair"] },
    { question: "é«˜è…³æ¤…", answer: "high stool", options: ["high stool","bar stool","counter stool","kitchen stool"] },
    { question: "é¤æ¡Œæ¤…", answer: "dining set", options: ["dining set","kitchen set","breakfast nook set","pub set"] },
    { question: "æ›¸æ¡Œæ¤…", answer: "desk chair", options: ["desk chair","office chair","task chair","executive chair"] },
    { question: "é›»è…¦æ¤…", answer: "computer chair", options: ["computer chair","gaming chair","ergonomic chair","office chair"] },

];
//colorPool ç´…è‰² è—è‰² ç´«è‰² æ·±ç¶ è‰²ï¼Œæ©˜è‰²
// const colorPool = ["red", "blue", "", "#32CD32", "#9370DB", "#00CED1"];
const colorPool = ["#FF6347", "#4682B4", "#9370DB", "green", "red","blue"]; // ç´…è‰², è—è‰², ç´«è‰², æ·±ç¶ è‰²
const coinDisplay = document.getElementById("coinDisplay");


function playPronunciation(word, speed = 0.5) {
  if (!('speechSynthesis' in window)) {
    console.warn('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åˆæˆ');
    return;
  }

  const utterance = new SpeechSynthesisUtterance(word);
  utterance.lang = 'en-US';
  utterance.rate = speed;  // ç™¼éŸ³é€Ÿåº¦

  speechSynthesis.speak(utterance);
}

const speedRange = document.getElementById('speedRange');
const speedValue = document.getElementById('speedValue');

speedRange.addEventListener('input', () => {
  speedValue.textContent = speedRange.value;
});


let blocks = [];
let ball = {
  x: 200, y: 550, radius: 10,
  vx: 0, vy: 0,
  dragging: false,
  startX: 0, startY: 0,
  showLine: false
};

// æ–°å¢å…¨å±€è¨Šæ¯è®Šæ•¸
let message = "";
let messageTimeout = null;

function showMessage(text) {
  message = text;
  if (messageTimeout) clearTimeout(messageTimeout);
  messageTimeout = setTimeout(() => {
    message = "";
  }, 5000);
}

let coins = 0;

// å„²å­˜èˆ‡æ›´æ–°é¡¯ç¤ºé‡‘å¹£
function saveCoins() {
  localStorage.setItem("coins", coins);
  coinDisplay.innerText = coins;
}

function addCoins(amount) {
  coins += amount;
  if (coins < 0) coins = 0;
  saveCoins();
}

// æ›´æ–°éŠæˆ²é‚è¼¯æ™‚ï¼Œä¾ç­”é¡Œçµæœæ›´æ–°é‡‘å¹£
function onHitBlock(isCorrect,answer) {
  if (isCorrect) {
    addCoins(10);
    
    showMessage("âœ…" + answer);
  } else {
    addCoins(-10);
    showMessage("âŒ");
  }
}

// ç•«é¢ç¹ªè£½ä¸­åŠ å…¥è¨Šæ¯ç¹ªè£½
function drawMessage() {
  if (!message) return;
  ctx.save();
  ctx.font = "bold 48px sans-serif";
ctx.fillStyle = message.includes("âœ…") ? "#0f0" : "#f00";

  ctx.shadowColor = "#000";
  ctx.shadowBlur = 8;
  ctx.textAlign = "center";
  ctx.fillText(message, canvas.width / 2, canvas.height / 2);
  ctx.restore();
}
// åˆå§‹åŒ–éŠæˆ²ç‹€æ…‹
let currentQ = null;
let lastQ = null;
function loadQuestion() {
      do {
    currentQ = Math.floor(Math.random() * questionSet.length);
  } while (currentQ === lastQ && questionSet.length > 1);
  lastQ = currentQ;
  // éš¨æ©Ÿå–å¾—ä¸€å€‹é¡Œç›® index
  currentQ = Math.floor(Math.random() * questionSet.length);
  const q = questionSet[currentQ];
  
  questionTitle.innerText = `è«‹æ‰¾å‡ºï¼šã€Œ${q.question}ã€ çš„è‹±æ–‡`;
    const positions = [
    { x: 0,  y: 20  }, // å·¦ä¸Š
    { x: 180, y: -100 }, // å³ä¸Š
    { x: 0,  y: 180 }, // å·¦ä¸‹
    { x: 180, y: 300 }  // å³ä¸‹
  ];
  blocks = [];
  let shuffled = [...q.options].sort(() => Math.random() - 0.5);
  for (let i = 0; i < 4; i++) {
    blocks.push({
      word: shuffled[i],
      x: positions[i].x - 20,
      y: positions[i].y + 200,
      w: 130,
      h: 40,
      hit: false,
      opacity: 1,
      exploding: false,
      color: colorPool[Math.floor(Math.random() * colorPool.length)]
    });
  }
  resetBall();
}
function resetBall() {
  ball.x = 200;
  ball.y = 300;
  ball.vx = 0;
  ball.vy = 0;
}

function drawBall() {
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
  ctx.fillStyle = "#fff";
  ctx.fill();

  // æ‹–æ›³é è¦½ç·š
  if (ball.dragging && ball.showLine) {
    ctx.beginPath();
    ctx.moveTo(ball.x, ball.y);
    ctx.lineTo(ball.startX, ball.startY);
    ctx.strokeStyle = "rgba(255,255,255,0.5)";
    ctx.setLineDash([5, 5]);
    ctx.stroke();
    ctx.setLineDash([]);
  }
}
function drawBlocks() {
  blocks.forEach(block => {
    if (block.hit && block.opacity <= 0) return;
    if (block.exploding) {
      block.opacity -= 0.05;
      if (block.opacity < 0) block.opacity = 0;
    }
    ctx.save();
    ctx.globalAlpha = block.opacity;
    ctx.fillStyle = block.color;
    ctx.shadowColor = "rgba(0,0,0,0.7)";
    ctx.shadowBlur = 6;
    ctx.fillRect(block.x +50, block.y, block.w, block.h);
    ctx.fillStyle = "#fff";
    ctx.shadowColor = "#000";
    ctx.shadowBlur = 3;
    ctx.font = "bold 18px sans-serif";
    ctx.fillText(block.word, block.x + block.w / 2, block.y + block.h / 2 + 6);
    ctx.restore();
  });
}


function updateBall() {
  if (!ball.dragging && (ball.vx !== 0 || ball.vy !== 0)) {
    ball.x += ball.vx;
    ball.y += ball.vy;
    ball.vy += 0.2; // gravity
  }

  if (ball.x <= 0 || ball.x >= canvas.width) ball.vx *= -1;
  if (ball.y <= 0 || ball.y >= canvas.height) resetBall();

  blocks.forEach(block => {
    if (block.hit) return;
    if (ball.x > block.x && ball.x < block.x + block.w &&
        ball.y > block.y && ball.y < block.y + block.h) {
      block.hit = true;
      block.exploding = true;

      if (block.word === questionSet[currentQ].answer) {
            const answer = questionSet[currentQ].answer
         const speed = parseFloat(speedRange.value) || 0.5;
        playPronunciation(answer, speed);
        onHitBlock(true,answer);
        //ç­”å°çƒå›åˆ°ä¸­å¿ƒ
        resetBall()
        setTimeout(() => {
          loadQuestion();
        }, 5000);
      } else {
            //çƒå›åˆ°ä¸­å¿ƒ
        resetBall()

        onHitBlock(false);
        setTimeout(() => {
         
        }, 2000);
      }
    }
  });
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawBall();
  drawBlocks();
  updateBall();
  drawMessage();
  requestAnimationFrame(draw);
}

// æ‹–æ›³æ§åˆ¶
function startDrag(x, y) {
  const dx = x - ball.x;
  const dy = y - ball.y;
  if (Math.sqrt(dx * dx + dy * dy) < ball.radius + 10) {
    ball.dragging = true;
    ball.startX = x;
    ball.startY = y;
    ball.showLine = true;
  }
}
function moveDrag(x, y) {
  if (ball.dragging) {
    ball.x = x;
    ball.y = y;
  }
}
function endDrag(x, y) {
  if (ball.dragging) {
    const dx = ball.startX - x;
    const dy = ball.startY - y;
    ball.vx = dx * 0.2;
    ball.vy = dy * 0.2;
    ball.dragging = false;
    ball.showLine = false;
  }
}

// æ»‘é¼ èˆ‡è§¸æ§æ”¯æ´
canvas.addEventListener('mousedown', e => {
  const rect = canvas.getBoundingClientRect();
  startDrag(e.clientX - rect.left, e.clientY - rect.top);
});
canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  moveDrag(e.clientX - rect.left, e.clientY - rect.top);
});
canvas.addEventListener('mouseup', e => {
  const rect = canvas.getBoundingClientRect();
  endDrag(e.clientX - rect.left, e.clientY - rect.top);
});
canvas.addEventListener('touchstart', e => {
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  startDrag(touch.clientX - rect.left, touch.clientY - rect.top);
});
canvas.addEventListener('touchmove', e => {
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  moveDrag(touch.clientX - rect.left, touch.clientY - rect.top);
});
canvas.addEventListener('touchend', e => {
  endDrag(ball.x, ball.y);
});

loadQuestion();
draw();

window.onload = function() {
  coins = parseInt(localStorage.getItem('coins')) || 0; // é è¨­100é‡‘å¹£
  saveCoins();
  loadQuestion();
  draw();
};
</script>
</body>
</html>
